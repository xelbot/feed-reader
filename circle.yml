machine:
  timezone:
    Europe/Zaporozhye
  pre:
    - sudo apt-get update; USE_PRECOMPILE=true sudo -E circleci-install php 7.1.0
  php:
    version: 7.1.0
  node:
    version: 4.2.6

checkout:
  post:
    - cp ./data/circleci/behat.yml ./app/config/parameters.yml
    - cp ./data/circleci/behat.yml ./behat.yml

dependencies:
  cache_directories:
    - vendor
    - bin
  override:
    - npm install -g bower
    - npm install -g uglifycss
    - npm install -g uglify-js
    - composer install --no-interaction
    - bower install
    - app/console assetic:dump -e test --no-debug
  post:
    - echo "date.timezone = Europe/Zaporozhye" >> ~/.phpenv/versions/5.5.9/etc/php.ini

database:
  override:
    - app/console doctrine:database:drop -e test --no-interaction --force
    - app/console doctrine:database:create -e test --no-interaction
    - app/console doctrine:migrations:migrate -e test --no-interaction
    - app/console doctrine:fixtures:load -e test --no-interaction

test:
  pre:
    - chmod -R 777 var/cache
    - chmod -R 777 var/logs
  override:
    - bin/php-cs-fixer fix --dry-run --diff
    - bin/behat @TestBundle
